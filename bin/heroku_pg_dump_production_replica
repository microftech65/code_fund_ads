#!/bin/sh
rm -f ./tmp/production-shallow.dump

if [[ -z "$METABASE_URL" ]]; then
  echo "METABASE_URL environment variable not set!"
  exit 1
fi

if [[ -z "$AWS_S3_ACCESS_KEY_ID" ]]; then
  echo "AWS_S3_ACCESS_KEY_ID environment variable not set! It should be set to the production value."
  exit 1
fi

pg_dump --verbose --no-acl --no-owner --format=c \
  --exclude-table=impressions_2018_11_advertiser_123 \
  --exclude-table=impressions_2018_11_advertiser_132 \
  --exclude-table=impressions_2018_11_advertiser_137 \
  --exclude-table=impressions_2018_11_advertiser_144 \
  --exclude-table=impressions_2018_11_advertiser_146 \
  --exclude-table=impressions_2018_11_advertiser_155 \
  --exclude-table=impressions_2018_11_advertiser_158 \
  --exclude-table=impressions_2018_11_advertiser_160 \
  --exclude-table=impressions_2018_11_advertiser_169 \
  --exclude-table=impressions_2018_11_advertiser_185 \
  --exclude-table=impressions_2018_12_advertiser_123 \
  --exclude-table=impressions_2018_12_advertiser_137 \
  --exclude-table=impressions_2018_12_advertiser_158 \
  --exclude-table=impressions_2018_12_advertiser_185 \
  --exclude-table=impressions_2019_01_advertiser_123 \
  --exclude-table=impressions_2019_01_advertiser_132 \
  --exclude-table=impressions_2019_01_advertiser_137 \
  --exclude-table=impressions_2019_01_advertiser_146 \
  --exclude-table=impressions_2019_01_advertiser_147 \
  --exclude-table=impressions_2019_01_advertiser_185 \
  --exclude-table=impressions_2019_01_advertiser_199 \
  --exclude-table=impressions_2019_01_advertiser_213 \
  --exclude-table=impressions_2019_01_advertiser_222 \
  --exclude-table=impressions_2019_02_advertiser_123 \
  --exclude-table=impressions_2019_02_advertiser_132 \
  --exclude-table=impressions_2019_02_advertiser_137 \
  --exclude-table=impressions_2019_02_advertiser_146 \
  --exclude-table=impressions_2019_02_advertiser_147 \
  --exclude-table=impressions_2019_02_advertiser_158 \
  --exclude-table=impressions_2019_02_advertiser_185 \
  --exclude-table=impressions_2019_02_advertiser_213 \
  --exclude-table=impressions_2019_02_advertiser_217 \
  --exclude-table=impressions_2019_02_advertiser_220 \
  --exclude-table=impressions_2019_02_advertiser_222 \
  --exclude-table=impressions_2019_02_advertiser_236 \
  --exclude-table=impressions_2019_02_advertiser_239 \
  --exclude-table=impressions_2019_02_advertiser_278 \
  --exclude-table=impressions_2019_03_advertiser_117 \
  --exclude-table=impressions_2019_03_advertiser_123 \
  --exclude-table=impressions_2019_03_advertiser_132 \
  --exclude-table=impressions_2019_03_advertiser_137 \
  --exclude-table=impressions_2019_03_advertiser_146 \
  --exclude-table=impressions_2019_03_advertiser_158 \
  --exclude-table=impressions_2019_03_advertiser_160 \
  --exclude-table=impressions_2019_03_advertiser_185 \
  --exclude-table=impressions_2019_03_advertiser_19 \
  --exclude-table=impressions_2019_03_advertiser_220 \
  --exclude-table=impressions_2019_03_advertiser_222 \
  --exclude-table=impressions_2019_03_advertiser_236 \
  --exclude-table=impressions_2019_03_advertiser_239 \
  --exclude-table=impressions_2019_03_advertiser_267 \
  --exclude-table=impressions_2019_03_advertiser_278 \
  --exclude-table=impressions_2019_03_advertiser_383 \
  --exclude-table=impressions_2019_04_advertiser_117 \
  --exclude-table=impressions_2019_04_advertiser_123 \
  --exclude-table=impressions_2019_04_advertiser_132 \
  --exclude-table=impressions_2019_04_advertiser_137 \
  --exclude-table=impressions_2019_04_advertiser_146 \
  --exclude-table=impressions_2019_04_advertiser_160 \
  --exclude-table=impressions_2019_04_advertiser_185 \
  --exclude-table=impressions_2019_04_advertiser_19 \
  --exclude-table=impressions_2019_04_advertiser_220 \
  --exclude-table=impressions_2019_04_advertiser_222 \
  --exclude-table=impressions_2019_04_advertiser_239 \
  --exclude-table=impressions_2019_04_advertiser_267 \
  --exclude-table=impressions_2019_04_advertiser_272 \
  --exclude-table=impressions_2019_04_advertiser_305 \
  --exclude-table=impressions_2019_04_advertiser_349 \
  --exclude-table=impressions_2019_04_advertiser_365 \
  --exclude-table=impressions_2019_04_advertiser_378 \
  --exclude-table=impressions_2019_04_advertiser_381 \
  --exclude-table=impressions_2019_04_advertiser_383 \
  --exclude-table=impressions_2019_04_advertiser_385 \
  --exclude-table=impressions_2019_04_advertiser_387 \
  --exclude-table=impressions_2019_04_advertiser_390 \
  --exclude-table=impressions_2019_04_advertiser_435 \
  --exclude-table=impressions_2019_04_advertiser_453 \
  --exclude-table=impressions_2019_04_advertiser_468 \
  --exclude-table=impressions_2019_04_advertiser_471 \
  --exclude-table=impressions_2019_04_advertiser_96 \
  --exclude-table=impressions_2019_05_advertiser_123 \
  --exclude-table=impressions_2019_05_advertiser_132 \
  --exclude-table=impressions_2019_05_advertiser_146 \
  --exclude-table=impressions_2019_05_advertiser_147 \
  --exclude-table=impressions_2019_05_advertiser_160 \
  --exclude-table=impressions_2019_05_advertiser_185 \
  --exclude-table=impressions_2019_05_advertiser_220 \
  --exclude-table=impressions_2019_05_advertiser_222 \
  --exclude-table=impressions_2019_05_advertiser_239 \
  --exclude-table=impressions_2019_05_advertiser_272 \
  --exclude-table=impressions_2019_05_advertiser_305 \
  --exclude-table=impressions_2019_05_advertiser_349 \
  --exclude-table=impressions_2019_05_advertiser_365 \
  --exclude-table=impressions_2019_05_advertiser_381 \
  --exclude-table=impressions_2019_05_advertiser_385 \
  --exclude-table=impressions_2019_05_advertiser_387 \
  --exclude-table=impressions_2019_05_advertiser_390 \
  --exclude-table=impressions_2019_05_advertiser_453 \
  --exclude-table=impressions_2019_05_advertiser_468 \
  --exclude-table=impressions_2019_05_advertiser_471 \
  --exclude-table=impressions_2019_05_advertiser_508 \
  --exclude-table=impressions_2019_05_advertiser_529 \
  --exclude-table=impressions_2019_05_advertiser_534 \
  --exclude-table=impressions_2019_05_advertiser_96 \
  --exclude-table=impressions_2019_06_advertiser_123 \
  --exclude-table=impressions_2019_06_advertiser_132 \
  --exclude-table=impressions_2019_06_advertiser_146 \
  --exclude-table=impressions_2019_06_advertiser_147 \
  --exclude-table=impressions_2019_06_advertiser_160 \
  --exclude-table=impressions_2019_06_advertiser_185 \
  --exclude-table=impressions_2019_06_advertiser_220 \
  --exclude-table=impressions_2019_06_advertiser_222 \
  --exclude-table=impressions_2019_06_advertiser_239 \
  --exclude-table=impressions_2019_06_advertiser_305 \
  --exclude-table=impressions_2019_06_advertiser_365 \
  --exclude-table=impressions_2019_06_advertiser_387 \
  --exclude-table=impressions_2019_06_advertiser_390 \
  --exclude-table=impressions_2019_06_advertiser_460 \
  --exclude-table=impressions_2019_06_advertiser_471 \
  --exclude-table=impressions_2019_06_advertiser_498 \
  --exclude-table=impressions_2019_06_advertiser_514 \
  --exclude-table=impressions_2019_06_advertiser_515 \
  --exclude-table=impressions_2019_06_advertiser_534 \
  --exclude-table=impressions_2019_06_advertiser_572 \
  --exclude-table=impressions_2019_06_advertiser_576 \
  --exclude-table=impressions_2019_06_advertiser_578 \
  --exclude-table=impressions_2019_06_advertiser_592 \
  --exclude-table=impressions_2019_06_advertiser_593 \
  --exclude-table=impressions_2019_07_advertiser_123 \
  --exclude-table=impressions_2019_07_advertiser_132 \
  --exclude-table=impressions_2019_07_advertiser_146 \
  --exclude-table=impressions_2019_07_advertiser_147 \
  --exclude-table=impressions_2019_07_advertiser_185 \
  --exclude-table=impressions_2019_07_advertiser_199 \
  --exclude-table=impressions_2019_07_advertiser_220 \
  --exclude-table=impressions_2019_07_advertiser_239 \
  --exclude-table=impressions_2019_07_advertiser_305 \
  --exclude-table=impressions_2019_07_advertiser_365 \
  --exclude-table=impressions_2019_07_advertiser_387 \
  --exclude-table=impressions_2019_07_advertiser_460 \
  --exclude-table=impressions_2019_07_advertiser_468 \
  --exclude-table=impressions_2019_07_advertiser_514 \
  --exclude-table=impressions_2019_07_advertiser_515 \
  --exclude-table=impressions_2019_07_advertiser_572 \
  --exclude-table=impressions_2019_07_advertiser_576 \
  --exclude-table=impressions_2019_07_advertiser_578 \
  --exclude-table=impressions_2019_07_advertiser_592 \
  --exclude-table=impressions_2019_07_advertiser_601 \
  --exclude-table=impressions_2019_07_advertiser_609 \
  --exclude-table=impressions_2019_07_advertiser_612 \
  --exclude-table=impressions_2019_07_advertiser_619 \
  --exclude-table=impressions_2019_07_advertiser_624 \
  --exclude-table=impressions_2019_07_advertiser_625 \
  --exclude-table=impressions_2019_08_advertiser_123 \
  --exclude-table=impressions_2019_08_advertiser_132 \
  --exclude-table=impressions_2019_08_advertiser_146 \
  --exclude-table=impressions_2019_08_advertiser_147 \
  --exclude-table=impressions_2019_08_advertiser_185 \
  --exclude-table=impressions_2019_08_advertiser_199 \
  --exclude-table=impressions_2019_08_advertiser_239 \
  --exclude-table=impressions_2019_08_advertiser_305 \
  --exclude-table=impressions_2019_08_advertiser_365 \
  --exclude-table=impressions_2019_08_advertiser_387 \
  --exclude-table=impressions_2019_08_advertiser_468 \
  --exclude-table=impressions_2019_08_advertiser_576 \
  --exclude-table=impressions_2019_08_advertiser_578 \
  --exclude-table=impressions_2019_08_advertiser_592 \
  --exclude-table=impressions_2019_08_advertiser_601 \
  --exclude-table=impressions_2019_08_advertiser_612 \
  --exclude-table=impressions_2019_08_advertiser_613 \
  --exclude-table=impressions_2019_08_advertiser_615 \
  --exclude-table=impressions_2019_08_advertiser_624 \
  --exclude-table=impressions_2019_08_advertiser_628 \
  --exclude-table=impressions_2019_08_advertiser_632 \
  --exclude-table=impressions_2019_08_advertiser_645 \
  --exclude-table=impressions_2019_08_advertiser_648 \
  --exclude-table=impressions_2019_08_advertiser_651 \
  --exclude-table=impressions_2019_08_advertiser_656 \
  --exclude-table=impressions_2019_08_advertiser_660 \
  --exclude-table=impressions_2019_08_advertiser_699 \
  --exclude-table=impressions_2019_09_advertiser_117 \
  --exclude-table=impressions_2019_09_advertiser_123 \
  --exclude-table=impressions_2019_09_advertiser_132 \
  --exclude-table=impressions_2019_09_advertiser_146 \
  --exclude-table=impressions_2019_09_advertiser_185 \
  --exclude-table=impressions_2019_09_advertiser_239 \
  --exclude-table=impressions_2019_09_advertiser_272 \
  --exclude-table=impressions_2019_09_advertiser_305 \
  --exclude-table=impressions_2019_09_advertiser_365 \
  --exclude-table=impressions_2019_09_advertiser_387 \
  --exclude-table=impressions_2019_09_advertiser_576 \
  --exclude-table=impressions_2019_09_advertiser_578 \
  --exclude-table=impressions_2019_09_advertiser_592 \
  --exclude-table=impressions_2019_09_advertiser_612 \
  --exclude-table=impressions_2019_09_advertiser_613 \
  --exclude-table=impressions_2019_09_advertiser_615 \
  --exclude-table=impressions_2019_09_advertiser_619 \
  --exclude-table=impressions_2019_09_advertiser_624 \
  --exclude-table=impressions_2019_09_advertiser_632 \
  --exclude-table=impressions_2019_09_advertiser_646 \
  --exclude-table=impressions_2019_09_advertiser_650 \
  --exclude-table=impressions_2019_09_advertiser_651 \
  --exclude-table=impressions_2019_09_advertiser_656 \
  --exclude-table=impressions_2019_09_advertiser_660 \
  --exclude-table=impressions_2019_09_advertiser_695 \
  --exclude-table=impressions_2019_09_advertiser_697 \
  --exclude-table=impressions_2019_09_advertiser_699 \
  --exclude-table=impressions_2019_09_advertiser_700 \
  --exclude-table=impressions_2019_09_advertiser_705 \
  --exclude-table=impressions_2019_09_advertiser_707 \
  --exclude-table=impressions_2019_09_advertiser_711 \
  --exclude-table=impressions_2019_09_advertiser_712 \
  --exclude-table=impressions_2019_09_advertiser_719 \
  --exclude-table=impressions_2019_09_advertiser_722 \
  --exclude-table=impressions_2019_09_advertiser_723 \
  --exclude-table=impressions_2019_09_advertiser_725 \
  --exclude-table=impressions_2019_10_advertiser_123 \
  --exclude-table=impressions_2019_10_advertiser_132 \
  --exclude-table=impressions_2019_10_advertiser_146 \
  --exclude-table=impressions_2019_10_advertiser_185 \
  --exclude-table=impressions_2019_10_advertiser_239 \
  --exclude-table=impressions_2019_10_advertiser_305 \
  --exclude-table=impressions_2019_10_advertiser_365 \
  --exclude-table=impressions_2019_10_advertiser_457 \
  --exclude-table=impressions_2019_10_advertiser_572 \
  --exclude-table=impressions_2019_10_advertiser_576 \
  --exclude-table=impressions_2019_10_advertiser_612 \
  --exclude-table=impressions_2019_10_advertiser_613 \
  --exclude-table=impressions_2019_10_advertiser_615 \
  --exclude-table=impressions_2019_10_advertiser_619 \
  --exclude-table=impressions_2019_10_advertiser_624 \
  --exclude-table=impressions_2019_10_advertiser_632 \
  --exclude-table=impressions_2019_10_advertiser_646 \
  --exclude-table=impressions_2019_10_advertiser_651 \
  --exclude-table=impressions_2019_10_advertiser_659 \
  --exclude-table=impressions_2019_10_advertiser_660 \
  --exclude-table=impressions_2019_10_advertiser_697 \
  --exclude-table=impressions_2019_10_advertiser_700 \
  --exclude-table=impressions_2019_10_advertiser_705 \
  --exclude-table=impressions_2019_10_advertiser_707 \
  --exclude-table=impressions_2019_10_advertiser_710 \
  --exclude-table=impressions_2019_10_advertiser_711 \
  --exclude-table=impressions_2019_10_advertiser_712 \
  --exclude-table=impressions_2019_10_advertiser_722 \
  --exclude-table=impressions_2019_10_advertiser_723 \
  --exclude-table=impressions_2019_10_advertiser_725 \
  --exclude-table=impressions_2019_10_advertiser_727 \
  --exclude-table=impressions_2019_11_advertiser_123 \
  --exclude-table=impressions_2019_11_advertiser_146 \
  --exclude-table=impressions_2019_11_advertiser_185 \
  --exclude-table=impressions_2019_11_advertiser_239 \
  --exclude-table=impressions_2019_11_advertiser_272 \
  --exclude-table=impressions_2019_11_advertiser_305 \
  --exclude-table=impressions_2019_11_advertiser_365 \
  --exclude-table=impressions_2019_11_advertiser_387 \
  --exclude-table=impressions_2019_11_advertiser_457 \
  --exclude-table=impressions_2019_11_advertiser_572 \
  --exclude-table=impressions_2019_11_advertiser_576 \
  --exclude-table=impressions_2019_11_advertiser_613 \
  --exclude-table=impressions_2019_11_advertiser_615 \
  --exclude-table=impressions_2019_11_advertiser_619 \
  --exclude-table=impressions_2019_11_advertiser_624 \
  --exclude-table=impressions_2019_11_advertiser_632 \
  --exclude-table=impressions_2019_11_advertiser_646 \
  --exclude-table=impressions_2019_11_advertiser_651 \
  --exclude-table=impressions_2019_11_advertiser_659 \
  --exclude-table=impressions_2019_11_advertiser_660 \
  --exclude-table=impressions_2019_11_advertiser_697 \
  --exclude-table=impressions_2019_11_advertiser_700 \
  --exclude-table=impressions_2019_11_advertiser_707 \
  --exclude-table=impressions_2019_11_advertiser_710 \
  --exclude-table=impressions_2019_11_advertiser_711 \
  --exclude-table=impressions_2019_11_advertiser_712 \
  --exclude-table=impressions_2019_11_advertiser_714 \
  --exclude-table=impressions_2019_11_advertiser_723 \
  --exclude-table=impressions_2019_11_advertiser_727 \
  --exclude-table=impressions_2019_11_advertiser_735 \
  --exclude-table=impressions_2019_11_advertiser_769 \
  --exclude-table=impressions_2019_11_advertiser_779 \
  --exclude-table=impressions_2019_11_advertiser_788 \
  --exclude-table=impressions_2019_11_advertiser_789 \
  --exclude-table=impressions_2019_11_advertiser_850 \
  --exclude-table=impressions_2019_11_advertiser_863 \
  --exclude-table=impressions_2019_11_advertiser_864 \
  --exclude-table=impressions_2019_12_advertiser_123 \
  --exclude-table=impressions_2019_12_advertiser_132 \
  --exclude-table=impressions_2019_12_advertiser_146 \
  --exclude-table=impressions_2019_12_advertiser_185 \
  --exclude-table=impressions_2019_12_advertiser_239 \
  --exclude-table=impressions_2019_12_advertiser_305 \
  --exclude-table=impressions_2019_12_advertiser_365 \
  --exclude-table=impressions_2019_12_advertiser_387 \
  --exclude-table=impressions_2019_12_advertiser_43 \
  --exclude-table=impressions_2019_12_advertiser_457 \
  --exclude-table=impressions_2019_12_advertiser_572 \
  --exclude-table=impressions_2019_12_advertiser_613 \
  --exclude-table=impressions_2019_12_advertiser_619 \
  --exclude-table=impressions_2019_12_advertiser_624 \
  --exclude-table=impressions_2019_12_advertiser_632 \
  --exclude-table=impressions_2019_12_advertiser_646 \
  --exclude-table=impressions_2019_12_advertiser_660 \
  --exclude-table=impressions_2019_12_advertiser_700 \
  --exclude-table=impressions_2019_12_advertiser_707 \
  --exclude-table=impressions_2019_12_advertiser_710 \
  --exclude-table=impressions_2019_12_advertiser_712 \
  --exclude-table=impressions_2019_12_advertiser_714 \
  --exclude-table=impressions_2019_12_advertiser_723 \
  --exclude-table=impressions_2019_12_advertiser_727 \
  --exclude-table=impressions_2019_12_advertiser_735 \
  --exclude-table=impressions_2019_12_advertiser_769 \
  --exclude-table=impressions_2019_12_advertiser_779 \
  --exclude-table=impressions_2019_12_advertiser_788 \
  --exclude-table=impressions_2019_12_advertiser_789 \
  --exclude-table=impressions_2019_12_advertiser_849 \
  --exclude-table=impressions_2019_12_advertiser_850 \
  --exclude-table=impressions_2019_12_advertiser_863 \
  --exclude-table=impressions_2019_12_advertiser_869 \
  --exclude-table=impressions_2020_01_advertiser_123 \
  --exclude-table=impressions_2020_01_advertiser_146 \
  --exclude-table=impressions_2020_01_advertiser_185 \
  --exclude-table=impressions_2020_01_advertiser_239 \
  --exclude-table=impressions_2020_01_advertiser_305 \
  --exclude-table=impressions_2020_01_advertiser_365 \
  --exclude-table=impressions_2020_01_advertiser_387 \
  --exclude-table=impressions_2020_01_advertiser_43 \
  --exclude-table=impressions_2020_01_advertiser_457 \
  --exclude-table=impressions_2020_01_advertiser_613 \
  --exclude-table=impressions_2020_01_advertiser_619 \
  --exclude-table=impressions_2020_01_advertiser_624 \
  --exclude-table=impressions_2020_01_advertiser_628 \
  --exclude-table=impressions_2020_01_advertiser_646 \
  --exclude-table=impressions_2020_01_advertiser_700 \
  --exclude-table=impressions_2020_01_advertiser_712 \
  --exclude-table=impressions_2020_01_advertiser_723 \
  --exclude-table=impressions_2020_01_advertiser_727 \
  --exclude-table=impressions_2020_01_advertiser_735 \
  --exclude-table=impressions_2020_01_advertiser_769 \
  --exclude-table=impressions_2020_01_advertiser_869 \
  --exclude-table=impressions_default \
  $METABASE_URL > ./tmp/production-shallow.dump
