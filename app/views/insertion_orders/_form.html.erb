<%= form_for @insertion_order, authenticity_token: false do |f| %>
  <div class="row">
    <div class="col-12">
      <%= render "/insertion_orders/errors", record: @insertion_order %>
    </div>

    <div class="col-3">
      <div class="form-group <%= classes "form-group-with-errors": @insertion_order.errors.include?(:budget) %>">
        <label>Budget (USD)</label>
        <%= f.number_field :budget, autofocus: true, class: "form-control form-control-lg", data: {reflex: "debounced-input->InsertionOrdersReflex#set_budget"} %>
      </div>
    </div>

    <div class="col-3">
      <div class="form-group <%= classes "form-group-with-errors": @insertion_order.errors.include?(:start_date) || @insertion_order.errors.include?(:end_date) %>">
        <label>Dates</label>
        <%= f.text_field :date_range,
            class: "js-range-datepicker form-control form-control-lg bg-white rounded",
            data: {
              controller: "select-date-range",
              reflex: "debounced-input->InsertionOrdersReflex#set_dates",
              start_date: @insertion_order.start_date.to_s("mm/dd/yyyy"),
              end_date: @insertion_order.end_date.to_s("mm/dd/yyyy"),
            } %>
      </div>
    </div>

    <div class="col-3">
      <div class="form-group">
        <label>Allocated Budget</label>
        <div class="form-control form-control-lg bg-transparent">
          <%= @insertion_order.allocated_budget.format %>
          <span class="text-muted">(<%= number_to_percentage @insertion_order.allocated_budget_percentage, precision: 1 %>)</span>
        </div>
      </div>
    </div>

    <div class="col-3">
      <div class="form-group">
        <label>Impressions</label>
        <div class="form-control form-control-lg bg-transparent">
          <%= number_with_delimiter @insertion_order.estimated_impressions_count %>
        </div>
      </div>
    </div>
  </div>

  <%= render partial: "/insertion_orders/campaign_fields", collection: @insertion_order.campaigns, as: :campaign, locals: {f: f} %>

  <div class="row">
    <%= button_panel margin: "my-0" do %>
      <% if @insertion_order.valid? %>
        <%= f.submit "Submit Insertion Order", class: "btn btn-lg btn-primary", disable_with: "Submitting Insertion Order..." %>
      <% elsif !@insertion_order.budget_allocated? %>
        <a href="" class="btn btn-lg btn-primary text-white" data-reflex="click->InsertionOrdersReflex#add_campaign">Add Campaign</a>
      <% end %>
    <% end %>
  </div>

  <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
<% end %>
